<template>
	<nav
		id="subHeader"
		class="c-sub-header"
		:class="{
			search: isSearch,
			transparent: isTransparent,
			appear: isAppear,
			'scroll-top': isScrollTop,
			'with-alert': withAlert,
		}"
	>
		<CNewGrid :fluid="isMobileView">
			<CNewRow>
				<CNewCol>
					<CTabs
						ref="subHeader"
						class="c-sub-header-tabs"
						:tab-index="tabIndex"
						with-header
						:type="isMobileView ? 'swiper' : 'basic'"
						@changeTabIndex="changeTabs"
					>
						<template v-for="(menu, index) in items" :slot="'item' + index">
							<span v-if="menu.notice" :key="`notice${index}`" class="c-sub-header-new-notice" />
							<!--    nuxt 유무에 따라 핸들링          -->
							<nuxt-link v-if="isNuxt" :key="menu.path" :to="menu.path" :data-cy="menu.name">
								<CButton :key="index" class="c-sub-header-menu" :class="{ active: tabIndex === index }">
									{{ menu.name }}
								</CButton>
							</nuxt-link>
							<a v-else :key="menu.path" :href="menu.path" :data-cy="menu.name">
								<CButton :key="index" class="c-sub-header-menu" :class="{ active: tabIndex === index }">
									{{ menu.name }}
								</CButton>
							</a>
						</template>
					</CTabs>
				</CNewCol>
			</CNewRow>
		</CNewGrid>
	</nav>
</template>

<script>
import CNewCol from '@/components/layout/CNewCol.vue';
import CTabs from '@/components/components/dataDisplay/CTabs.vue.bak';
import CNewGrid from '@/components/layout/CNewGrid.vue';
import CNewRow from '@/components/layout/CNewRow.vue';
import CButton from '@/components/components/general/button/CButton.vue';
import useWindowResize from '@/services/useWindowResize';
import { defineComponent, toRefs, computed } from 'vue';

export default defineComponent({
	name: 'CSubHeader',
	props: {
		// 헤더가 숨어있다가 나오는지 여부
		isAppear: {
			type: Boolean,
			default: false,
		},
		isScrollTop: {
			type: Boolean,
			default: true,
		},
		items: {
			type: Array,
			default: () => [],
		},
		isSearch: {
			type: Boolean,
			default: false,
		},
		isNuxt: {
			type: Boolean,
			default: false,
		},
		isTransparent: {
			type: Boolean,
			default: false,
		},
		isMobileView: {
			type: Boolean,
			default: false,
		},
		withAlert: {
			type: Boolean,
			default: false,
		},
	},
	emits: ['change-tab-index'],
	setup(props, { emit }) {
		const { items } = toRefs(props);
		const { isMobile } = useWindowResize();
		const tabIndex = computed(() => items.value.findIndex(item => item.active));
		const changeTabs = tabs => emit('change-tab-index', tabIndex, tabs);

		return {
			isMobile,
			tabIndex,
			changeTabs,
		};
	},
	components: { CNewRow, CNewGrid, CTabs, CNewCol, CButton },
});
</script>

<style lang="scss" scoped>
$active-bar-transparent: white;
$hover-background-transparent: rgba(21, 22, 23, 0.1);
.c-sub-header {
	width: 100vw;
	top: 24px;
	left: 0;
	background-color: $white;
	transition: top 0.1s linear, opacity 0.1s ease-in;
	z-index: 80;
	position: fixed;
	::v-deep .c-tabs--menu-container {
		border-bottom: 1px solid $gray100;
		@include pc {
			// sub header 높이를 맞추기 위한 border
			border-bottom: 1px solid transparent;
		}
	}
	@include mobile {
		top: 52px;
	}
	&-new-notice {
		position: absolute;
		bottom: 32px;
		right: 0;
		width: 4px;
		height: 4px;
		background: $secondary;
		@include border-radius(4px);
	}

	&.appear {
		top: 52px;
		@include pc {
			top: 69px;
		}
		&.with-alert {
			top: calc(52px + 64px);
			@include pc {
				top: calc(69px + 56px);
			}
		}
	}

	&.scroll-top {
		position: relative;
	}

	&-tabs {
		overflow: visible;
		@include mobile {
			padding: 0 12px;
		}
	}

	&.search {
		background-color: $gray050;
		::v-deep .c-tabs--menu-container {
			background-color: $gray050;
			@include pc {
				// sub header 높이를 맞추기 위한 border
				border-bottom: 1px solid transparent;
			}
		}
		@include mobile {
			background-color: $white;
			::v-deep .c-tabs--menu-container {
				border-bottom: 1px solid $gray100;
				background-color: $white;
			}
		}
	}
	&:not(.transparent) {
		@include pc {
			@include shadow3();
		}
	}

	&.transparent {
		background-color: transparent;
		.c-tabs--menu-container {
			background: transparent;
			border-bottom: none;

			::v-deep .c-tabs--menu-button {
				&:hover {
					& .c-button {
						color: $white;
					}
				}
			}
		}

		::v-deep {
			.c-tabs--menu-wrapper,
			.swiper-wrapper {
				.c-tabs--menu-button {
					@include pc {
						&:hover {
							background-color: $hover-background-transparent !important;
						}
					}

					&.active {
						.c-button {
							color: $active-bar-transparent !important;
						}

						&:after {
							background: $active-bar-transparent !important;
						}
					}
				}
				@include mobile {
					.active {
						.c-button {
							color: $active-bar-transparent !important;
						}
						&:after {
							background: $active-bar-transparent !important;
						}
					}
				}
			}
		}
	}
}

::v-deep .swiper-slide {
	&.active {
		&::after {
			background-color: $blue600;
		}
	}
}

::v-deep .c-tabs--menu-button {
	> a {
		text-decoration: none;
	}
	&:hover {
		background-color: transparent !important;
		& .c-button {
			color: $blue800;
		}
	}
	.c-button {
		&.active {
			@include body2();
			font-weight: 500 !important;
			color: $blue600 !important;
		}
	}
	&.active::after {
		background-color: $blue600;
	}
}
</style>
