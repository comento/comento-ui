<template>
	<div class="c-application c-text-field" :class="[computedLabel]">
		<input
			:ref="computedId"
			v-model="sync_value"
			class="c-text-field--input"
			:type="type"
			:placeholder="placeholder"
			:name="computedId"
			:label="label"
			:align="align"
			:focus="focus"
			:readonly="readonly"
			:disabled="disabled"
			:hint="hint"
			:hint-color="hintColor"
			:style="[computedAlign]"
			:class="[computedLined, computedErrorColor]"
			v-bind="$attrs"
			@input="handleTyping"
			v-on="$listeners"
		/>
		<label v-if="computedShowLabel" :for="computedId" class="c-text-field--label">{{ label }}</label>
		<Typography
			v-if="hintMessage !== ''"
			type="caption2"
			:color="hintColor"
			element="p"
			class="c-text-field--message"
		>
			<Icon name="IconExclamationSmallFill" :color="hintColor" class="mr-2" />{{ hintMessage }}
		</Typography>
	</div>
</template>

<script>
import Icon from '@/src/Elements/Core/Icon/Icon';
import Typography from '@/src/Elements/Core/Typography/Typography';

export const textFieldTypes = ['text', 'number', 'password', 'email', 'tel', 'url'];
export const textFieldAligns = ['left', 'center', 'right'];
export const textFieldErrorColor = ['primary', 'success', 'secondary', 'error'];

export default {
	name: 'TextField',
	inheritAttrs: false,
	props: {
		type: {
			type: String,
			default: 'text',
			validator(value) {
				const isValid = textFieldTypes.indexOf(value) !== -1;
				if (!isValid) {
					console.error(`${value} is not a valid name of the TextField type`);
				}
				return isValid;
			},
		},
		value: {
			type: String,
			default: '',
		},
		placeholder: {
			type: String,
			default: '내용을 입력하세요.',
		},
		label: {
			type: String,
			default: null,
		},
		outlined: {
			type: Boolean,
			default: false,
		},
		align: {
			type: String,
			default: 'left',
			validator(value) {
				const isValid = textFieldAligns.indexOf(value) !== -1;
				if (!isValid) {
					console.error(`${value} is not a valid name of the TextField align`);
				}
				return isValid;
			},
		},
		focus: {
			type: Boolean,
			default: false,
		},
		readonly: {
			type: Boolean,
			default: false,
		},
		disabled: {
			type: Boolean,
			default: false,
		},
		hint: {
			type: Boolean,
			default: false,
		},
		hintColor: {
			type: String,
			default: 'error',
			validator(value) {
				const isValid = textFieldErrorColor.indexOf(value) !== -1;
				if (isValid) {
					return isValid;
				}
			},
		},
		hintMessage: {
			type: String,
			default: '',
		},
	},
	computed: {
		sync_value: {
			get() {
				return this.value;
			},
			set(val) {
				this.$emit('update:value', val);
			},
		},
		computedLined() {
			if (this.outlined) {
				return 'outlined';
			} else {
				return 'underlined';
			}
		},
		computedId() {
			return `textField-${this._uid}`;
		},
		computedShowLabel() {
			return this.label;
		},
		computedLabel() {
			return { label: this.computedShowLabel };
		},
		computedAlign() {
			return {
				textAlign: this.align,
			};
		},
		computedErrorColor() {
			if (this.hint) {
				return this.hintColor;
			} else {
				return '';
			}
		},
	},
	mounted() {
		if (this.focus) {
			this.$refs[this.computedId].focus();
		}
	},
	methods: {
		handleTyping(e) {
			this.sync_value = e.target.value;
		},
	},
	components: { Typography, Icon },
};
</script>

<style lang="scss" scoped>
.c-text-field {
	position: relative;
	&--input {
		display: block;
		width: 100%;
		height: 40px;
		border: 0;
		color: $gray800;
		@include body1;
		@include transition(all 0.2s ease);
		&::placeholder {
			color: $gray300;
		}
		&:disabled {
			background: $gray000;
		}
		&.outlined {
			padding: 0 16px;
			border: 1px solid $gray200;
			@include border-radius(2px);
			&:focus {
				border-color: $gray400;
			}
			&.error {
				border-color: $red400;
				&:focus {
					border-color: $red400;
				}
			}
			&.primary {
				border-color: $primary;
				&:focus {
					border-color: $primary;
				}
			}
			&.success {
				border-color: $success;
				&:focus {
					border-color: $success;
				}
			}
			&.secondary {
				border-color: $secondary;
				&:focus {
					border-color: $secondary;
				}
			}
		}
		&.underlined {
			padding: 0 4px;
			border-bottom: 1px solid $gray200;
			&:focus {
				border-color: $gray400;
			}
			&.error {
				border-color: $error;
				&:focus {
					border-color: $error;
				}
			}
			&.primary {
				border-color: $primary;
				&:focus {
					border-color: $primary;
				}
			}
			&.success {
				border-color: $success;
				&:focus {
					border-color: $success;
				}
			}
			&.secondary {
				border-color: $secondary;
				&:focus {
					border-color: $secondary;
				}
			}
		}
		&:disabled {
			cursor: not-allowed !important;
			&:active {
				pointer-events: none;
			}
		}
		&[readonly],
		&[readonly='readonly'] {
			&:focus {
				border-color: $gray200;
			}
		}
	}
	&.label {
		.c-text-field--input {
			&:focus {
				+ .c-text-field--label {
					opacity: 1;
				}
			}
			&.error {
				border-color: $error;
				&:focus {
					border-color: $red400;
					+ .c-text-field--label {
						color: $error;
					}
				}
			}
			&.primary {
				border-color: $primary;
				&:focus {
					border-color: $primary;
					+ .c-text-field--label {
						color: $primary;
					}
				}
			}
			&.success {
				border-color: $success;
				&:focus {
					border-color: $success;
					+ .c-text-field--label {
						color: $success;
					}
				}
			}
			&.secondary {
				border-color: $secondary;
				&:focus {
					border-color: $secondary;
					+ .c-text-field--label {
						color: $secondary;
					}
				}
			}
			&:focus {
				border-color: $green600;
				+ .c-text-field--label {
					opacity: 1;
					color: $green600;
				}
			}
			&[readonly],
			&[readonly='readonly'] {
				&:focus {
					border-color: $gray200;
				}
				+ .c-text-field--label {
					opacity: 0;
				}
			}
		}
		.c-text-field--label {
			@include transition(all 0.2s ease);
			position: absolute;
			top: -6px;
			left: 12px;
			padding: 0 2px;
			background: $white;
			@include caption2;
			opacity: 0;
		}
	}
	&--message {
		margin-top: 5px;
		@include clearfix;
		&::v-deep .c-icon {
			float: left;
			margin-top: -1px;
		}
	}
}
</style>
